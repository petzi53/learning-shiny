[{"name":"app.R","content":"library(shiny)\n\n# sales_filepath <- paste0(here::here(), \"/data/sales_data_sample.csv\")\n# sales <- vroom::vroom(sales_filepath, col_types = list(), na = \"\")\n\nui <- fluidPage(\n    selectInput(\"territory\", \"Territory\", choices = NULL),\n    selectInput(\"customername\", \"Customer\", choices = NULL),\n    selectInput(\"ordernumber\", \"Order number\", choices = NULL),\n    tableOutput(\"data\"),\n    verbatimTextOutput(\"my_sales\")\n)\n\nserver <- function(input, output, session) {\n\n    sales <- reactiveVal()\n\n    observe({\n        url <- \"https://github.com/hadley/mastering-shiny/raw/refs/heads/main/sales-dashboard/sales_data_sample.csv\"\n        my_df <- vroom::vroom(url, delim = \",\", col_types = list(), na = \"\")\n        sales(my_df)\n        updateSelectInput(inputId = \"territory\", choices = unique(sales()$TERRITORY))\n    }) |>\n        bindEvent(sales(), ignoreNULL = FALSE, ignoreInit = FALSE, once = TRUE)\n\n    territory <- reactive({\n        req(input$territory)\n        dplyr::filter(sales(), TERRITORY == input$territory)\n    })\n\n    observeEvent(territory(), {\n        choices <- unique(territory()$CUSTOMERNAME)\n        updateSelectInput(inputId = \"customername\", choices = choices)\n    })\n\n    customer <- reactive({\n        req(input$customername)\n        dplyr::filter(territory(), CUSTOMERNAME == input$customername)\n    })\n    observeEvent(customer(), {\n        choices <- unique(customer()$ORDERNUMBER)\n        updateSelectInput(inputId = \"ordernumber\", choices = choices)\n    })\n\n    output$data <- renderTable({\n        req(input$ordernumber)\n        customer()  |>\n            dplyr::filter(ORDERNUMBER == input$ordernumber)  |>\n            dplyr::select(QUANTITYORDERED, PRICEEACH, PRODUCTCODE)\n    })\n\n    # output$my_sales <-  renderPrint({\n    #     if (!is.null(sales())) {\n    #         print(input$territory)\n    #     } else {\n    #         print(head(my_df))\n    #         print(\"sales = NULL\")\n    #     }\n    # })\n}\n\nshinyApp(ui, server)\n","type":"text"}]
